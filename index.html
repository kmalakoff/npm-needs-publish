<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>npm-needs-publish</title><meta name="description" content="Documentation for npm-needs-publish"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">npm-needs-publish</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>npm-needs-publish</h1></div><div class="tsd-panel tsd-typography"><h1 id="npm-needs-publish" class="tsd-anchor-link">npm-needs-publish<a href="#npm-needs-publish" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Smart publish detection for npm packages - semantic package.json comparison with semver-aware dependency analysis.</p>
<h2 id="problem" class="tsd-anchor-link">Problem<a href="#problem" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Traditional publish detection methods have limitations:</p>
<ul>
<li><strong>Hash comparison</strong>: Any package.json change triggers publish (even irrelevant ones like <code>devDependencies</code>)</li>
<li><strong>Version-only check</strong>: Doesn't detect content changes when version stays the same</li>
<li><strong>Git-based</strong>: Requires tags, CI needs <code>fetch-depth: 0</code></li>
</ul>
<h2 id="solution" class="tsd-anchor-link">Solution<a href="#solution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>npm-needs-publish</code> provides intelligent publish detection by:</p>
<ol>
<li><strong>Semantic package.json comparison</strong> - Ignores irrelevant fields (<code>devDependencies</code>, <code>scripts</code>, metadata)</li>
<li><strong>Semver-aware dependency analysis</strong> - Understands that <code>^1.2.3</code> → <code>^1.2.4</code> may be equivalent</li>
<li><strong>Dependency type awareness</strong> - Only <code>dependencies</code> and <code>peerDependencies</code> affect consumers</li>
<li><strong>File-level comparison</strong> - Detects actual code changes, not just metadata</li>
</ol>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">npm-needs-publish</span>
</code><button type="button">Copy</button></pre>

<h2 id="cli-usage" class="tsd-anchor-link">CLI Usage<a href="#cli-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-3"># Check if current directory needs publishing</span><br/><span class="hl-0">npm-needs-publish</span><br/><br/><span class="hl-3"># Check with JSON output</span><br/><span class="hl-0">npm-needs-publish</span><span class="hl-1"> </span><span class="hl-4">--json</span><br/><br/><span class="hl-3"># Check specific directory with verbose output</span><br/><span class="hl-0">npm-needs-publish</span><span class="hl-1"> </span><span class="hl-4">--cwd</span><span class="hl-1"> </span><span class="hl-2">./packages/my-package</span><span class="hl-1"> </span><span class="hl-4">--verbose</span>
</code><button type="button">Copy</button></pre>

<h3 id="options" class="tsd-anchor-link">Options<a href="#options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--cwd &lt;path&gt;</code></td>
<td>Working directory (default: current directory)</td>
</tr>
<tr>
<td><code>--registry &lt;url&gt;</code></td>
<td>Registry URL override</td>
</tr>
<tr>
<td><code>--json</code></td>
<td>Output result as JSON</td>
</tr>
<tr>
<td><code>--verbose, -v</code></td>
<td>Show detailed change breakdown</td>
</tr>
<tr>
<td><code>--package-json-only</code></td>
<td>Only compare package.json, skip file comparison</td>
</tr>
<tr>
<td><code>--no-optional-deps</code></td>
<td>Exclude optionalDependencies from comparison</td>
</tr>
</tbody>
</table>
<h3 id="exit-codes" class="tsd-anchor-link">Exit Codes<a href="#exit-codes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>0</code> - Package does NOT need publishing</li>
<li><code>1</code> - Package NEEDS publishing</li>
<li><code>2</code> - Error occurred</li>
</ul>
<h2 id="programmatic-usage" class="tsd-anchor-link">Programmatic Usage<a href="#programmatic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">needsPublish</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;npm-needs-publish&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">needsPublish</span><span class="hl-1">({ </span><span class="hl-6">cwd:</span><span class="hl-1"> </span><span class="hl-6">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">() });</span><br/><br/><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">result</span><span class="hl-1">.</span><span class="hl-6">needsPublish</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Publish needed:&#39;</span><span class="hl-1">, </span><span class="hl-6">result</span><span class="hl-1">.</span><span class="hl-6">reason</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">// Proceed with npm publish</span><br/><span class="hl-1">} </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;No publish needed:&#39;</span><span class="hl-1">, </span><span class="hl-6">result</span><span class="hl-1">.</span><span class="hl-6">reason</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="options-1" class="tsd-anchor-link">Options<a href="#options-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-8">NeedsPublishOptions</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">cwd</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;                        </span><span class="hl-3">// Working directory</span><br/><span class="hl-1">  </span><span class="hl-6">package</span><span class="hl-1">?: </span><span class="hl-8">PackageJson</span><span class="hl-1">;               </span><span class="hl-3">// Pre-loaded package.json</span><br/><span class="hl-1">  </span><span class="hl-6">registry</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;                   </span><span class="hl-3">// Registry URL override</span><br/><span class="hl-1">  </span><span class="hl-6">includeOptionalDeps</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1">;       </span><span class="hl-3">// Include optionalDependencies (default: true)</span><br/><span class="hl-1">  </span><span class="hl-6">additionalSignificantFields</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">[]; </span><span class="hl-3">// Extra fields to consider significant</span><br/><span class="hl-1">  </span><span class="hl-6">ignoreFields</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">[];             </span><span class="hl-3">// Fields to ignore</span><br/><span class="hl-1">  </span><span class="hl-6">packageJsonOnly</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1">;           </span><span class="hl-3">// Skip file comparison</span><br/><span class="hl-1">  </span><span class="hl-6">treatNarrowingAsEquivalent</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1">; </span><span class="hl-3">// Treat narrowed ranges as equivalent (default: true)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="result" class="tsd-anchor-link">Result<a href="#result" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-8">NeedsPublishResult</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">needsPublish</span><span class="hl-1">: </span><span class="hl-8">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">reason</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">changes</span><span class="hl-1">?: </span><span class="hl-8">ChangeDetail</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="algorithm" class="tsd-anchor-link">Algorithm<a href="#algorithm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ol>
<li><strong>Fetch registry packument</strong> → if E404, return <code>needsPublish=true</code> (first publish)</li>
<li><strong>Version check</strong> → if different, return <code>needsPublish=true</code> (intentional bump)</li>
<li><strong>Fast hash check</strong> → if identical, return <code>needsPublish=false</code> (no changes)</li>
<li><strong>Extract both tarballs, compare file-by-file</strong> (excluding package.json)</li>
<li><strong>If non-package.json files differ</strong> → return <code>needsPublish=true</code></li>
<li><strong>If only package.json differs</strong> → do semantic comparison:
<ul>
<li>Compare significant fields only (<code>main</code>, <code>exports</code>, <code>bin</code>, <code>types</code>, etc.)</li>
<li>Compare dependencies with semver-aware logic</li>
<li>Ignore <code>devDependencies</code>, <code>scripts</code>, metadata fields</li>
<li>Return based on whether changes affect consumers</li>
</ul>
</li>
</ol>
<p>For a detailed explanation with flow diagrams, see <a href="media/ALGORITHM.md">ALGORITHM.md</a>.</p>
<h2 id="significant-vs-non-significant-fields" class="tsd-anchor-link">Significant vs Non-Significant Fields<a href="#significant-vs-non-significant-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="significant-affect-consumers" class="tsd-anchor-link">Significant (affect consumers)<a href="#significant-affect-consumers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>name</code>, <code>version</code>, <code>main</code>, <code>module</code>, <code>browser</code>, <code>exports</code>, <code>types</code>, <code>typings</code>, <code>type</code></li>
<li><code>bin</code>, <code>files</code>, <code>engines</code>, <code>os</code>, <code>cpu</code>, <code>peerDependenciesMeta</code>, <code>packageManager</code></li>
<li><code>dependencies</code>, <code>peerDependencies</code>, <code>optionalDependencies</code> (configurable), <code>bundledDependencies</code></li>
</ul>
<h3 id="not-significant-metadata-only" class="tsd-anchor-link">Not Significant (metadata only)<a href="#not-significant-metadata-only" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>devDependencies</code>, <code>scripts</code></li>
<li><code>repository</code>, <code>homepage</code>, <code>bugs</code>, <code>author</code>, <code>contributors</code></li>
<li><code>license</code>, <code>keywords</code>, <code>description</code></li>
</ul>
<h2 id="semver-range-comparison" class="tsd-anchor-link">Semver Range Comparison<a href="#semver-range-comparison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The tool understands semver range equivalence and is optimized for <code>npm update</code> / <code>ncu -u</code> workflows:</p>
<table>
<thead>
<tr>
<th>Change</th>
<th style="text-align:center">Triggers Publish?</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^1.2.3</code> → <code>^1.2.3</code></td>
<td style="text-align:center">No</td>
<td>Identical</td>
</tr>
<tr>
<td><code>^1.2.3</code> → <code>^1.2.4</code></td>
<td style="text-align:center">No</td>
<td>Same major (caret)</td>
</tr>
<tr>
<td><code>^1.2.3</code> → <code>^1.5.0</code></td>
<td style="text-align:center">No</td>
<td>Same major (caret)</td>
</tr>
<tr>
<td><code>^1.2.3</code> → <code>^2.0.0</code></td>
<td style="text-align:center">Yes</td>
<td>Different major</td>
</tr>
<tr>
<td><code>~1.2.3</code> → <code>~1.2.4</code></td>
<td style="text-align:center">No</td>
<td>Same minor (tilde)</td>
</tr>
<tr>
<td><code>~1.2.3</code> → <code>~1.3.0</code></td>
<td style="text-align:center">Yes</td>
<td>Different minor</td>
</tr>
<tr>
<td><code>*</code> → <code>^4.17.0</code></td>
<td style="text-align:center">No*</td>
<td>Narrowed (optimistic default)</td>
</tr>
<tr>
<td><code>^4.17.0</code> → <code>*</code></td>
<td style="text-align:center">Yes</td>
<td>Widened</td>
</tr>
</tbody>
</table>
<p>*Set <code>treatNarrowingAsEquivalent: false</code> for conservative behavior where narrowing triggers publish.</p>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>MIT</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#npm-needs-publish"><span>npm-<wbr/>needs-<wbr/>publish</span></a><ul><li><a href="#problem"><span>Problem</span></a></li><li><a href="#solution"><span>Solution</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#cli-usage"><span>CLI <wbr/>Usage</span></a></li><li><ul><li><a href="#options"><span>Options</span></a></li><li><a href="#exit-codes"><span>Exit <wbr/>Codes</span></a></li></ul></li><li><a href="#programmatic-usage"><span>Programmatic <wbr/>Usage</span></a></li><li><ul><li><a href="#options-1"><span>Options</span></a></li><li><a href="#result"><span>Result</span></a></li></ul></li><li><a href="#algorithm"><span>Algorithm</span></a></li><li><a href="#significant-vs-non-significant-fields"><span>Significant vs <wbr/>Non-<wbr/>Significant <wbr/>Fields</span></a></li><li><ul><li><a href="#significant-affect-consumers"><span>Significant (affect consumers)</span></a></li><li><a href="#not-significant-metadata-only"><span>Not <wbr/>Significant (metadata only)</span></a></li></ul></li><li><a href="#semver-range-comparison"><span>Semver <wbr/>Range <wbr/>Comparison</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">npm-needs-publish</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
